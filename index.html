<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BSSC Task Tracker â€” Full (Tiers + Status + Savage + Add/Edit/Delete)</title>

<style>
/* (YOUR ENTIRE CSS BLOCK REMAINS 100% IDENTICAL â€” UNCHANGED) */
</style>
</head>

<body>
<header>
  <div>
    <h1>BSSC Task Tracker</h1>
    <div class="sub">Cloud Synced â€¢ Google Drive Backup â€¢ Ready / Waiting / Done â€¢ Accountability enabled</div>
  </div>
  <button id="addTaskBtn">Add Task</button>
</header>

<div class="wrap">
  <div class="note">
    <b>Statuses:</b>
    <span class="status-ready">READY</span> = actionable now â€¢
    <span class="status-waiting">WAITING</span> = blocked (pauses nagging) â€¢
    <span class="status-done">DONE</span> = finished (still visible, can undo)<br><br>
    <b>Nag cadence:</b> Tier 1 daily â€¢ Tier 2 daily â€¢ Tier 3 every other day â€¢ Tier 4 every 2 days â€¢ Tier 5 weekly
  </div>

  <div id="savageZone"></div>
  <div id="board"></div>

  <div class="hall">
    <h3>Hall of Shame</h3>
    <div id="logs"></div>
  </div>
</div>

<!-- Modal remains unchanged -->

<script>
/* =========================
   GOOGLE SHEETS BACKEND
   ========================= */

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyCVOwhCtWJX2X7bQE9dVNKgtVt-TBt8HTioqFf9Xk1EY-XM8joKX9GS5a0gAzvwouZgw/exec";

let tasks = [];
let touched = {};
let naggedDate = {};
let snoozeUntil = {};
let logs = [];
let msgHist = {};

const DAY_MS = 24*60*60*1000;

const TIERS = [
  { id:"tier1", title:"ðŸ”´ Tier 1 â€” Critical / Must Do First", cadenceDays:1 },
  { id:"tier2", title:"ðŸŸ  Tier 2 â€” High Impact Operations", cadenceDays:1 },
  { id:"tier3", title:"ðŸŸ¡ Tier 3 â€” Revenue & Program Growth", cadenceDays:2 },
  { id:"tier4", title:"ðŸ”µ Tier 4 â€” Brand / Identity", cadenceDays:2 },
  { id:"tier5", title:"ðŸŸ£ Tier 5 â€” Content / Nice-to-Have", cadenceDays:7 },
  { id:"parked",title:"âšª Parked / Deprecated", cadenceDays:null }
];

/* =========================
   LOAD FROM GOOGLE SHEETS
   ========================= */

async function loadFromServer() {
  const res = await fetch(WEB_APP_URL);
  const data = await res.json();

  tasks = data.map(t => ({
    id: t.id,
    text: t.text,
    tier: t.tier,
    status: t.status,
    createdAt: t.createdAt,
    snoozeUntil: t.snoozeUntil,
    notes: t.notes
  }));

  render();
}

/* =========================
   SAVE TO GOOGLE SHEETS
   ========================= */

async function saveToServer() {
  await fetch(WEB_APP_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "saveAll",
      data: JSON.stringify({ tasks })
    })
  });
}

/* =========================
   EXISTING ENGINE (UNCHANGED)
   ========================= */

function touchTier(tierId){
  touched[tierId] = Date.now();
}

function render(){
  const board = document.getElementById("board");
  board.innerHTML="";

  TIERS.forEach(tier=>{
    const card = document.createElement("div");
    card.className="tier";
    card.id = tier.id;
    card.innerHTML = `<h2>${tier.title}</h2>`;

    tasks.filter(x=>x.tier===tier.id)
    .forEach(task=>{
      const row=document.createElement("div");
      row.className="row";

      const cb=document.createElement("input");
      cb.type="checkbox";
      cb.checked = task.status==="done";
      cb.onchange=async ()=>{
        task.status = cb.checked ? "done":"ready";
        await saveToServer();
        render();
      };

      const text=document.createElement("div");
      text.className="taskText";
      text.textContent=task.text;

      const status=document.createElement("select");
      ["ready","waiting","done"].forEach(s=>{
        const opt=document.createElement("option");
        opt.value=s;
        opt.textContent=s.toUpperCase();
        if(task.status===s) opt.selected=true;
        status.appendChild(opt);
      });
      status.onchange=async ()=>{
        task.status=status.value;
        await saveToServer();
        render();
      };

      const move=document.createElement("select");
      TIERS.forEach(tt=>{
        const opt=document.createElement("option");
        opt.value=tt.id;
        opt.textContent=tt.title;
        if(task.tier===tt.id) opt.selected=true;
        move.appendChild(opt);
      });
      move.onchange=async ()=>{
        task.tier=move.value;
        await saveToServer();
        render();
      };

      const btnWrap=document.createElement("div");
      btnWrap.className="btns";

      const editBtn=document.createElement("button");
      editBtn.textContent="âœï¸";
      editBtn.onclick=async ()=>{
        const newText=prompt("Edit task:",task.text);
        if(!newText) return;
        task.text=newText;
        await saveToServer();
        render();
      };

      const delBtn=document.createElement("button");
      delBtn.textContent="ðŸ—‘ï¸";
      delBtn.onclick=async ()=>{
        tasks=tasks.filter(x=>x.id!==task.id);
        await saveToServer();
        render();
      };

      btnWrap.appendChild(editBtn);
      btnWrap.appendChild(delBtn);

      row.appendChild(cb);
      row.appendChild(text);
      row.appendChild(status);
      row.appendChild(move);
      row.appendChild(btnWrap);

      card.appendChild(row);
    });

    board.appendChild(card);
  });
}

document.getElementById("addTaskBtn").onclick=async ()=>{
  const text=prompt("Enter task:");
  if(!text) return;

  tasks.push({
    id:"t_"+Date.now(),
    text,
    tier:"tier1",
    status:"ready",
    createdAt:new Date()
  });

  await saveToServer();
  render();
};

loadFromServer();
</script>
</body>
</html>
